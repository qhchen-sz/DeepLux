<vb:ModuleViewBase
    x:Class="Plugin.SaveData.Views.VarSetView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:cvt="[cvt ]clr-namespace:HV.Assets.Converter;assembly=HV"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:Plugin.SaveData.Views"
    xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
    xmlns:vm="clr-namespace:Plugin.SaveData.ViewModels"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:vb="clr-namespace:HV.Core;assembly=HV"
    Width="980"
    Height="680"
    Icon="/Plugin.SaveData;component/Assets/Images/Tool/SaveData.png"
    ResizeMode="NoResize"
    ShowMaxRestoreButton="False"
    ShowMinButton="False"
    WindowStartupLocation="CenterScreen"
    
    mc:Ignorable="d">
    <vb:ModuleViewBase.Resources>
        <local:EnumToBooleanConverter x:Key="EnumToBooleanConverter"/>
        <local:PathModeToVisibilityConverter x:Key="PathModeToVisibilityConverter"/>
        <local:VariableModeToVisibilityConverter x:Key="VariableModeToVisibilityConverter"/>
    </vb:ModuleViewBase.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition />
            <RowDefinition Height="55" />
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition  Width="200"/>
            <ColumnDefinition />
            <ColumnDefinition Width="85" />
        </Grid.ColumnDefinitions>
        <Grid>
            <GroupBox Header="设置" HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
                <GroupBox.Resources>
                    <Style TargetType="GroupBox">
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="GroupBox">
                                    <Grid>
                                        <Border BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" CornerRadius="4">
                                            <Grid>
                                                <!-- Header背景 -->
                                                <Border x:Name="HeaderBackground" Background="Transparent" 
                                            Margin="10,0,0,0" 
                                            HorizontalAlignment="Left" 
                                            VerticalAlignment="Top"
                                            Height="24">
                                                    <ContentPresenter ContentSource="Header" Margin="6,0,6,0" VerticalAlignment="Center"/>
                                                </Border>
                                                <Border Margin="0,12,0,0" Background="{TemplateBinding Background}">
                                                    <ContentPresenter Margin="{TemplateBinding Padding}" />
                                                </Border>
                                            </Grid>
                                        </Border>
                                    </Grid>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </GroupBox.Resources>
                <StackPanel Margin="0,20,0,0">
                    <StackPanel Orientation="Horizontal"  >
                        <TextBlock Text="小数位数:" Margin="5" VerticalAlignment="Center" />
                        <TextBox Margin="5" Width="120" VerticalAlignment="Center" Text="{Binding DecimalPlaces}"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,20,0,0">
                        <TextBlock Text="文件名称:" Margin="5" VerticalAlignment="Center"/>
                        <TextBox HorizontalAlignment="Center" VerticalAlignment="Center" BorderThickness="0 0 0 1" Width="120" Margin="5 0" IsReadOnly="False"
                                                 Style="{StaticResource LinkTextBox}"
                                                 Text="{Binding InputFileLinkText}"
                                                 mah:TextBoxHelper.Value ="{Binding InputFileLinkText}"
                                                 mah:TextBoxHelper.LinkButtonCommand="{Binding LinkCommand,Mode=OneWay}"
                                                 mah:TextBoxHelper.LinkButtonCommandParameter="{x:Static vm:eLinkCommand.SaveFileName}"/>
                        
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="20,20,0,0">
                        <CheckBox Content="文件名自动添加时间" IsChecked="{Binding AutoAddTime }"/>

                    </StackPanel>

                    <StackPanel Orientation="Horizontal" Margin="20,20,0,0">
                        <CheckBox Content="使用日期文件夹归类" IsChecked="{Binding UseDateFolder }"/>

                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="20,20,0,0">
                        <CheckBox Content="第一列为时间" IsChecked="{Binding UseFirstColumnTime }"/>

                    </StackPanel>
                </StackPanel>
            </GroupBox>
        </Grid>
        <StackPanel Grid.Column="1" Orientation="Vertical" VerticalAlignment="Top" HorizontalAlignment="Center" >
            <Border
                BorderBrush="White"
                Height="50"
            BorderThickness="1,0,1,1">
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Left">
                    <Label Content="CSV保存路径" Margin="10,0,0,0"/>
                    <StackPanel>
                        <TextBox Grid.Column="1"  Style="{DynamicResource MahApps.Styles.TextBox.Search}" Width="400" Height="25" Text="{Binding FilePath}"
                                                        IsReadOnly="True"
                                                     Visibility="{Binding SelectedMode, Converter={StaticResource PathModeToVisibilityConverter}}"
                                                     mah:TextBoxHelper.ButtonCommand="{Binding FilePathCommand, Mode=OneWay}"/>
                        <Border   
            Grid.ColumnSpan="2"
            BorderBrush="White"
            BorderThickness="1,1,1,0">
                            <TextBox HorizontalAlignment="Center" VerticalAlignment="Center" BorderThickness="0 0 0 1" Width="400" Margin="5 0" IsReadOnly="True"
                                                 Style="{StaticResource LinkTextBox}"
                                                Visibility="{Binding SelectedMode, Converter={StaticResource VariableModeToVisibilityConverter}}"
                                                 Text="{Binding InputImageLinkText}"
                                                 mah:TextBoxHelper.Value ="{Binding InputImageLinkText}"
                                                 mah:TextBoxHelper.LinkButtonCommand="{Binding LinkCommand,Mode=OneWay}"
                                                 mah:TextBoxHelper.LinkButtonCommandParameter="{x:Static vm:eLinkCommand.SaveFilePath}"/>
                        </Border>

                    </StackPanel>


                    <StackPanel Orientation="Horizontal" Margin="10,0,0,0">
                        <RadioButton Content="链接路径" Margin="10,0,0,0"
                     IsChecked="{Binding SelectedMode, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter={x:Static vm:LinkMode.Path}}"/>
                        <RadioButton Content="链接变量" Margin="10,0,0,0"
                     IsChecked="{Binding SelectedMode, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter={x:Static vm:LinkMode.Variable}}"/>
                    </StackPanel>
                </StackPanel>
            </Border>
           
            <DataGrid
            x:Name="dg"
            AutoGenerateColumns="False"
            CanUserAddRows="False"
            EnableColumnVirtualization="True"
            EnableRowVirtualization="True"
            FontSize="12"
            GridLinesVisibility="All"
            HeadersVisibility="Column"
            ItemsSource="{Binding SaveData}"
            PreviewMouseDoubleClick="dg_PreviewMouseDoubleClick"
            RowHeaderWidth="20"
            SelectedIndex="{Binding SelectedIndex}"
            SelectedItem="{Binding SelectedVar}"
            SelectionUnit="FullRow"
            VirtualizingPanel.IsVirtualizing="True">
                <DataGrid.ContextMenu>
                    <ContextMenu>
                        <MenuItem Command="{Binding DeleteCommand}" Header="删除" />
                        <MenuItem
                        Command="{Binding MoveCommand}"
                        CommandParameter="Up"
                        Header="上移" />
                        <MenuItem
                        Command="{Binding MoveCommand}"
                        CommandParameter="Down"
                        Header="下移" />
                    </ContextMenu>
                </DataGrid.ContextMenu>
                <DataGrid.Columns>
                    <DataGridTextColumn
                    Width="auto"
                    Binding="{Binding DataType}"
                    CanUserSort="True"
                    Header="类型"
                    IsReadOnly="True" />
                    <DataGridTextColumn
                    Width="auto"
                    Binding="{Binding Name}"
                    CanUserSort="False"
                    Header="名称"
                    IsReadOnly="False" />
                    <DataGridTextColumn
                    Width="*"
                    Binding="{Binding Link}"
                    CanUserSort="False"
                    Header="链接"
                    IsReadOnly="True" />

                </DataGrid.Columns>
            </DataGrid>
        </StackPanel>
        
        <StackPanel Grid.Column="2">
            <StackPanel>
                <Button
                    Width="60"
                    Margin="5,10"
                    Command="{Binding LinkCommand}"
                    CommandParameter="{x:Static vm:eLinkCommand.AddContent}"
                    Content="添加" />
            </StackPanel>
            <StackPanel>
                <Button
                    Width="60"
                    Margin="5,80"
                    Command="{Binding DeleteCommand}"
                    Content="删除" />
            </StackPanel>
            <StackPanel>
                <Button
                    Width="60"
                    Margin="5,10"
                    Command="{Binding MoveCommand}"
                    CommandParameter="Up"
                    Content="上移" />
            </StackPanel>
            <StackPanel>
                <Button
                    Width="60"
                    Margin="5,10"
                    Command="{Binding MoveCommand}"
                    CommandParameter="Down"
                    Content="下移" />
            </StackPanel>
            <StackPanel>
                <Button
                    Width="60"
                    Margin="5,10"
                    Command="{Binding LineCommand}"
                    CommandParameter="Line"
                    Content="换行" />
            </StackPanel>
        </StackPanel>
        <Border
            Grid.Row="1"
            Grid.ColumnSpan="2"
            BorderBrush="White"
            BorderThickness="0,0.5,0,0">
            <DockPanel LastChildFill="True">
                <StackPanel
                    Margin="10,0,0,0"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center">
                    <TextBlock>
                        <Run Text="耗时:" />
                        <Run Text="{Binding ModuleParam.ElapsedTime}" />
                        <Run Text="ms" />
                    </TextBlock>
                    <TextBlock>
                        <Run Text="状态:" />
                        <Run Text="{Binding ModuleParam.Status, Converter={StaticResource StatusConverter}}" />
                    </TextBlock>
                </StackPanel>

                <StackPanel HorizontalAlignment="Right" Orientation="Horizontal">
                    <Button
                        x:Name="btnExecute"
                        Margin="10,0"
                        HorizontalAlignment="Right"
                        Command="{Binding ExecuteCommand}"
                        Content="执行" />
                    <Button
                        x:Name="btnCancel"
                        Margin="10,0"
                        HorizontalAlignment="Right"
                        Click="btnCancel_Click"
                        Content="取消" />
                    <Button
                        x:Name="btnConfirm"
                        Margin="10,0"
                        HorizontalAlignment="Right"
                        Background="#FFFF2000"
                        BorderBrush="#FFFF2000"
                        Command="{Binding ConfirmCommand}"
                        Content="确认" />
                </StackPanel>
            </DockPanel>
        </Border>
    </Grid>
</vb:ModuleViewBase>
