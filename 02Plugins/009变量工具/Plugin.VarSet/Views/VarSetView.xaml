<vb:ModuleViewBase
    x:Class="Plugin.VarSet.Views.VarSetView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:cvt="[cvt ]clr-namespace:HV.Assets.Converter;assembly=HV"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:Plugin.VarSet.Views"
    xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:vb="clr-namespace:HV.Core;assembly=HV"
    Width="980"
    Height="680"
    Icon="/Plugin.VarSet;component/Assets/Images/Tool/VarSet.png"
    ResizeMode="NoResize"
    ShowMaxRestoreButton="False"
    ShowMinButton="False"
    WindowStartupLocation="CenterScreen"
    mc:Ignorable="d">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition />
            <RowDefinition Height="55" />
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition />
            <ColumnDefinition Width="135" />
        </Grid.ColumnDefinitions>

        <DataGrid
            x:Name="dg"
            AutoGenerateColumns="False"
            CanUserAddRows="False"
            EnableColumnVirtualization="True"
            EnableRowVirtualization="True"
            FontSize="12"
            GridLinesVisibility="All"
            HeadersVisibility="Column"
            ItemsSource="{Binding VarSet}"
            PreviewMouseDoubleClick="dg_PreviewMouseDoubleClick"
            RowHeaderWidth="20"
            SelectedIndex="{Binding SelectedIndex}"
            SelectedItem="{Binding SelectedVar}"
            SelectionUnit="FullRow"
            VirtualizingPanel.IsVirtualizing="True">
            <DataGrid.ContextMenu>
                <ContextMenu>
                    <MenuItem Command="{Binding DeleteCommand}" Header="删除" />
                    <MenuItem
                        Command="{Binding MoveCommand}"
                        CommandParameter="Up"
                        Header="上移" />
                    <MenuItem
                        Command="{Binding MoveCommand}"
                        CommandParameter="Down"
                        Header="下移" />
                </ContextMenu>
            </DataGrid.ContextMenu>
            <DataGrid.Columns>
                <DataGridTextColumn
                    Binding="{Binding Index}"
                    CanUserSort="True"
                    Header="索引"
                    IsReadOnly="True" />
                <DataGridTextColumn
                    Width="auto"
                    Binding="{Binding DataType}"
                    CanUserSort="True"
                    Header="类型"
                    IsReadOnly="True" />
                <DataGridTextColumn
                    Width="*"
                    Binding="{Binding Link}"
                    CanUserSort="False"
                    Header="链接"
                    IsReadOnly="True" />
                <DataGridTextColumn
                    Width="*"
                    Binding="{Binding Expression}"
                    CanUserSort="False"
                    Header="表达式"
                    IsReadOnly="False" />
                <DataGridTextColumn
                    Width="100"
                    Binding="{Binding Value}"
                    CanUserSort="False"
                    Header="值"
                    IsReadOnly="True" />
                <DataGridTextColumn
                    Width="*"
                    Binding="{Binding Note}"
                    CanUserSort="False"
                    Header="注释"
                    IsReadOnly="False" />

            </DataGrid.Columns>
        </DataGrid>
        <StackPanel Grid.Column="1">
            <StackPanel>
                <Button
                    Width="60"
                    Margin="5,10"
                    Command="{Binding AddCommand}"
                    Content="添加" />
            </StackPanel>
            <StackPanel>
                <Button
                    Width="60"
                    Margin="5,80"
                    Command="{Binding DeleteCommand}"
                    Content="删除" />
            </StackPanel>
            <StackPanel>
                <Button
                    Width="60"
                    Margin="5,10"
                    Command="{Binding MoveCommand}"
                    CommandParameter="Up"
                    Content="上移" />
            </StackPanel>
            <StackPanel>
                <Button
                    Width="60"
                    Margin="5,10"
                    Command="{Binding MoveCommand}"
                    CommandParameter="Down"
                    Content="下移" />
            </StackPanel>
        </StackPanel>
        <Border
            Grid.Row="1"
            Grid.ColumnSpan="2"
            BorderBrush="White"
            BorderThickness="0,0.5,0,0">
            <DockPanel LastChildFill="True">
                <StackPanel
                    Margin="10,0,0,0"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center">
                    <TextBlock>
                        <Run Text="耗时:" />
                        <Run Text="{Binding ModuleParam.ElapsedTime}" />
                        <Run Text="ms" />
                    </TextBlock>
                    <TextBlock>
                        <Run Text="状态:" />
                        <Run Text="{Binding ModuleParam.Status, Converter={StaticResource StatusConverter}}" />
                    </TextBlock>
                </StackPanel>

                <StackPanel HorizontalAlignment="Right" Orientation="Horizontal">
                    <Button
                        x:Name="btnExecute"
                        Margin="10,0"
                        HorizontalAlignment="Right"
                        Command="{Binding ExecuteCommand}"
                        Content="执行" />
                    <Button
                        x:Name="btnCancel"
                        Margin="10,0"
                        HorizontalAlignment="Right"
                        Click="btnCancel_Click"
                        Content="取消" />
                    <Button
                        x:Name="btnConfirm"
                        Margin="10,0"
                        HorizontalAlignment="Right"
                        Background="#FFFF2000"
                        BorderBrush="#FFFF2000"
                        Command="{Binding ConfirmCommand}"
                        Content="确认" />
                </StackPanel>
            </DockPanel>
        </Border>
    </Grid>
</vb:ModuleViewBase>
